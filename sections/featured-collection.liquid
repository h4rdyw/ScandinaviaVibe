{% comment %}theme-check-disable{% endcomment %}

{% assign offset_products = section.settings.offset_products %}
{% assign number_of_products = section.settings.number_of_products %}
{% assign randomize = section.settings.randomize %}

            {% assign min = 0 %}
            {% assign max = offset_products %}
            {% assign diff = max | minus: min %}
            {% assign random_number = "now" | date: "%S" | modulo: diff | plus: min %}            

            {% assign limit_products = "limit: " | append: number_of_products %}
            {% assign offset_products = "offset: " | append: random_number %}
            

<section class="container py-4">
     <h2 class="text-center my-3">{{ section.settings.title }}</h2>
     <div id="prdRow" class="row d-flex g-3 row-cols-xxl-5 row-cols-lg-3 row-cols-md-2 row-cols-sm-2 row-cols-1 py-5">

        {% if randomize == true  %}   

        {% for product in collections[section.settings.featured_collection].products limit: number_of_products offset: random_number %}

            {% assign image = product.featured_media.preview_image %}
        <div class="col d-flex">
            <div class="img-wrapper d-flex">
            <div class="card d-flex flex-fill border-0 shadow-sm">                
                
                {% if image != blank %}
                    <div class="inner-img">
                    <a href="#" id="productInfoAnchor-{{ product.id }}" product-handle="{{ product.handle }}" 
                        product-price="{{ product.price | money_without_trailing_zeros }}"
                       ><img class="card-img-top" width="640" height="360" src="{{  image | img_url:'master' }}" loading="lazy"  alt="{{ product.title }}" 
                      ></a>
                        <div class="text-hover">BUY NOW</div>        
                    </div> 
                      
                {% else %}          
                <div class="inner-img">      
                    {{ 'product-1' | placeholder_svg_tag: 'card-img-top' }}
                </div>
                {% endif %}
         
                <div class="card-body d-flex flex-column justify-content-end bg-light text-center">
                    <p class="text-product-link" style="font-size:1.25rem;"><a class="text-product-link" href="{{ product.url }}">{{ product.title }}</a></p>    
                    <p span class="text-line"></p>
                    <p>{{ product.price | money_without_trailing_zeros }}</p>
                    
                </div>
                
        
            </div>
            </div>
        </div>
        

         {% endfor %}   
        {% else %} 
        {% for product in collections[section.settings.featured_collection].products limit: number_of_products %}


            {% assign image = product.featured_media.preview_image %}
            <div class="col d-flex">
                <div class="img-wrapper d-flex">
                <div class="card card-border d-flex flex-fill border-0 shadow-sm">
                    {% if image != blank %}
                        <div class="inner-img">
                        <a href="#" id="productInfoAnchor-{{ product.id }}" product-handle="{{ product.handle }}" 
                            product-price="{{ product.price | money_without_trailing_zeros }}"
                        ><img class="card-img-top" width="640" height="360" src="{{  image | img_url:'master' }}" loading="lazy" alt="{{ product.title }}" 
                        ></a>    
                        <div class="text-hover">BUY NOW</div>    
                    </div>
                        
                     
                    {% else %}
                    
                        {{ 'product-1' | placeholder_svg_tag: 'card-img-top' }}
            
                    {% endif %}
            
                    <div class="card-body d-flex flex-column justify-content-end bg-light text-center">
                        <p class="text-product-link" style="font-size:1.25rem;"><a class="text-product-link" href="{{ product.url }}">{{ product.title }}</a></p>    
                        <p span class="text-line"></p>
                        <p>{{ product.price | money_without_trailing_zeros }}</p>                    
                    </div>    
                </div>
                </div>
            </div>
        
         {% endfor %}  

        {% endif %}


     </div>
     
 </section>
 <div class="modal fade" id="productInfoModal" tabIndex="-1" aria-hidden="true" style="z-index:2000">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="border-bottom: none;">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                      <div class="col-12 col-md-6">                       
                        <img class="img-fluid" style="max-height: 50vh; width:auto;" src="" id="productInfoImg" alt="">
                      </div>
                      <div class="col-12 col-md-6 px-2">
                        <h1 id="productInfoTitle" class="text-product-title"></h1>
                        <p id="productInfoPrice" class="text-header-title"></p>
                        <p id="productInfoDescription" class="text-product-desc"></p>
                      </div>
                </div>             
            </div>
            <div class="modal-footer" style="border-top: none;">
                <div class="col-12 col-md-6"></div>
                <div class="col-12 col-md-6 px-2">
                    <form action="#" id="addToCartForm" class="row">
                        <select name="id" id="modalItemID" class="form-select col-auto">
                        </select>
                        <input type="number" name="quantity" value="1" id="modalItemQuantity" min="1" max="9999" class="col-auto w-100">
                        <p></p>
                        <button type="submit" id="btnAddToCart" class="btn-add-to-cart col-auto w-100">Add to Cart</button>
                        <p></p>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

 
{% schema %}
{
    "name": "Featured Collection",
    "class": "featured-collection-section",
    "settings": [
   {
        "type": "collection",
        "id": "featured_collection",
        "label": "Collection"
    },
    {
        "type": "text",
        "id": "title",
        "default": "Featured Collection",
        "label": "Title"
    },
    {
        "type": "range",
        "id": "number_of_products",
        "label": "Number of Products to Show",
        "default": 10,
        "min": 1,
        "max": 25,
        "step": 1
    },
    {
        "type": "checkbox",
        "id": "randomize",
        "default": true,
        "label": "Randomize"

    },
    {
        "type": "range",
        "id": "offset_products",
        "label": "Random Offset Max",
        "default": 5,
        "min": 5,
        "max": 100,
        "step": 1
    }                
    ],
    "presets": [
    {
        "category": "collection",
        "name": "Featured Collection"
    }
    ]
}
{% endschema %}

<style>
input {
    border-left: none;
    border-right: none;
    border-top: none;
    border-bottom: 1px solid #ced4da;
}
    
.form-select {
    border-left: none;
    border-right: none;
    border-top: none;
}

</style>

{% comment %}theme-check-enable{% endcomment %}
