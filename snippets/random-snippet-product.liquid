{% comment %}theme-check-disable{% endcomment %}
<script type="text/javascript">
    function fisherYates ( myArray ) {
      var i = myArray.length, j, temp;
        if ( i === 0 ) return false;
      while ( --i ) {
          j = Math.floor( Math.random() * ( i + 1 ) );
          temp = myArray[i];
          myArray[i] = myArray[j]; 
          myArray[j] = temp;
      }
    }
     
    var collection = new Array();
    {% for product in collection.products %}
      collection[{{ forloop.index | minus: 1 }}]="{% render 'random-product' %}";
    {% endfor %}
     
    fisherYates(collection);
    var randomCollection = collection[0];
    for(var i=1;i<collection.length;i++) {
      randomCollection += collection[i];
      if ( i && ((i+1) % 3 === 0)) {randomCollection += "<br class='clear product_clear' />";}
    }
    $('.random-collection').html(randomCollection);
    </script>
     {% comment %}theme-check-enable{% endcomment %}